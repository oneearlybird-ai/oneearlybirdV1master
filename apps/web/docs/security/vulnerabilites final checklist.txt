EarlyBird — Vulnerabilities & Final Security Checklist (Microscope Pass)
Date: __________  Environment: Preview / Production   DEPLOY_URL: ________________________

Instructions
- For each line item, mark Result and fill Reason. Do not modify item text.
- Result: use ✅ for Pass, ❌ for Fail. Example: Result: ✅  Reason: "header present with correct value".

Pre‑Flight
- Record commit hash, branch, deployed time.  Result: [✅/❌]  Reason: ________________________________
- Freeze deploys during this session.  Result: [✅/❌]  Reason: ______________________________________

Headers — Single Source in Middleware (curl -I on DEPLOY_URL)
- HSTS preload (includeSubDomains; preload).  Result: [✅/❌]  Reason: ________________________________
- CSP with per‑request nonce (script-src/style-src include 'nonce-…'; no unsafe-inline/eval).  Result: [✅/❌]  Reason: ________________________________
- COOP = same-origin.  Result: [✅/❌]  Reason: ________________________________________________
- COEP = require-corp (or credentialless with written justification).  Result: [✅/❌]  Reason: _________
- Permissions‑Policy deny list (geo, camera, microphone, payment, usb, xr, pip, webauthn).  Result: [✅/❌]  Reason: ________________________________
- X‑XSS‑Protection: 0.  Result: [✅/❌]  Reason: _________________________________________________
- X‑Content‑Type‑Options: nosniff.  Result: [✅/❌]  Reason: ______________________________________
- No x-powered-by header.  Result: [✅/❌]  Reason: ______________________________________________
- Single source confirmed (no headers in next.config.js).  Result: [✅/❌]  Reason: __________________

Routes/Manifest (GET /api/routes/manifest)
- Returns 200 and canonical routes set (no shadow/duplicate routes).  Result: [✅/❌]  Reason: ________
- Sensitive routes declare runtime='nodejs' and dynamic='force-dynamic'.  Result: [✅/❌]  Reason: _____

Stripe Webhook (POST /api/stripe/webhook)
- Unsigned request returns 400/403.  Result: [✅/❌]  Reason: ______________________________________
- Raw body is read via req.text() before constructEvent (code inspection).  Result: [✅/❌]  Reason: ____
- Signed delivery (Test mode) returns 2xx (Dashboard → Webhooks shows successes).  Result: [✅/❌]  Reason: _
- No PHI/secrets in logs for webhook handling.  Result: [✅/❌]  Reason: _____________________________

Twilio Ingress & Media Streams
- Unsigned POST /api/voice/incoming returns 403.  Result: [✅/❌]  Reason: _________________________
- TwiML contains <Response><Connect><Stream url="…"/></Connect></Response>.  Result: [✅/❌]  Reason: ____
- DNS for media.oneearlybird.ai (CNAME) resolves to provider.  Result: [✅/❌]  Reason: _____________
- TLS on https://media.oneearlybird.ai (port 443) valid certificate.  Result: [✅/❌]  Reason: ________
- WS upgrade 101 on /rtm/voice; ping/pong works; clean close.  Result: [✅/❌]  Reason: _____________
- No Twilio 31920 handshake errors in test call.  Result: [✅/❌]  Reason: _________________________
- No PHI in media logs; tokens redacted.  Result: [✅/❌]  Reason: ________________________________

Storage (S3 / S3‑compatible)
- Negative: POST /api/storage/presign without x-smoke-key → 403.  Result: [✅/❌]  Reason: __________
- Positive: With x-smoke-key, presign returns PUT URL; PUT small file → 200/204.  Result: [✅/❌]  Reason: _
- Key template enforced: {env}/tenants/{tenantId}/{type}/{yyyy}/{mm}/{dd}/{objectId}.{ext}.  Result: [✅/❌]  Reason: __
- Env in key matches VERCEL_ENV; date fields valid; restricted charset; no traversal.  Result: [✅/❌]  Reason: _
- S3 endpoint/path‑style configured if S3‑compatible; short TTL for presign.  Result: [✅/❌]  Reason: ____
- No PHI/secrets in keys or logs.  Result: [✅/❌]  Reason: _______________________________________

Rate Limiting (/api/ratelimit-test)
- Two rapid hits → 200 then 429.  Result: [✅/❌]  Reason: _______________________________________
- Cooldown window elapsed → 200 again.  Result: [✅/❌]  Reason: ________________________________
- Route is dynamic (never cached).  Result: [✅/❌]  Reason: ______________________________________

Environment Hygiene (Vercel Preview + Production)
- Exactly one value per environment per variable name (no duplicates).  Result: [✅/❌]  Reason: ______
- Variable names canonical (e.g., S3_BUCKET or AWS_S3_BUCKET; no typos like S3_AWS_BUCKET).  Result: [✅/❌]  Reason: _
- No secrets in repo; .env.example contains names/placeholders only.  Result: [✅/❌]  Reason: _________

CORS & Caching
- No wildcard CORS on Protected/PHI endpoints.  Result: [✅/❌]  Reason: __________________________
- Sensitive endpoints non‑cacheable (dynamic); CDN not caching webhooks/presign.  Result: [✅/❌]  Reason: _

OAuth/Integrations
- GET /api/integrations/oauth/start returns safe, allow‑listed redirects (no open redirect).  Result: [✅/❌]  Reason: __

Numbers & Voice Ops
- /api/numbers/buy and /api/numbers/webhook present; webhook signature validation plan verified.  Result: [✅/❌]  Reason: _
- /api/voice/{transfer,dial,recording,status} safe stubs or correct behavior; no PHI logs.  Result: [✅/❌]  Reason: _

Usage/Status/Health
- GET /api/status → 200; health only; no secrets/PHI.  Result: [✅/❌]  Reason: ____________________
- GET /api/usage/summary → 200; types clean; no PHI in body.  Result: [✅/❌]  Reason: _____________

UI Wiring (Design Freeze)
- No inline scripts; no header duplication client‑side; minimal affordances only.  Result: [✅/❌]  Reason: ____

Logging/Telemetry
- No secrets or PHI in logs; tokens redacted; 500s don’t leak stack traces to end users.  Result: [✅/❌]  Reason: _

Dependency/Secret Scans
- Dependency audit: no unaddressed high/critical vulns or documented acceptance.  Result: [✅/❌]  Reason: __
- Secret scans pass; no accidental secrets committed.  Result: [✅/❌]  Reason: ______________________

DNS/TLS (Global)
- oneearlybird.ai resolves correctly; cert valid (HTTPS).  Result: [✅/❌]  Reason: ________________
- Latest Vercel prod URL captured and reachable.  Result: [✅/❌]  Reason: ______________________
- media.oneearlybird.ai CNAME and TLS validated (if media live).  Result: [✅/❌]  Reason: __________

Evidence & Artifacts (Save to apps/web/docs/handoff_evidence/<date>/)
- Capture headers (top lines), manifest status, ratelimit transitions, presign PUT status, Stripe Dashboard delivery IDs, Twilio console refs, env name lists (no values).  Result: [✅/❌]  Reason: ______

Exit Criteria (All Must Pass)
- Headers baseline; Stripe unsigned 4xx + signed 2xx; Twilio unsigned 403 + media 101; Storage negative 403 + PUT 200/204; Ratelimit 200→429→200; Env hygiene OK; No PHI/secrets in logs; No wildcard CORS; No header duplication outside middleware.  Result: [✅/❌]  Reason: ______

